<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <!-- <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests"> -->
    <title>iris live</title>
    <link href="https://vjs.zencdn.net/7.4.1/video-js.css" rel="stylesheet">
    <script src='https://vjs.zencdn.net/7.4.1/video.js'></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/videojs-contrib-hls/5.15.0/videojs-contrib-hls.min.js" type="text/javascript"></script>
    
    <link rel="stylesheet" href="livestyle.css">
</head>
<body>
    <div class="backimg"></div>
    <section class="title">
        <h1>iris terminal</h1>
    </section>

    <div class="head-notice">
        <div class="notice-text">
            <h2>Now Broadcasting: <span id="albumname"></span></h2>
            <script>
                setInterval(updateAlbumName, 1000);

                function updateAlbumName() {
                    fetch('http://120.46.209.170/album_name')
                        .then(response => response.text())
                        .then(data => {
                            document.getElementById('albumname').textContent = data;
                        })
                        .catch(error => {
                            console.error('Error:', error);
                        });
                }
            </script>
        </div>
    </div>

    <section class="radio">
    <div class="cardtitle">
        <h2>Radio</h2>
    </div>
    <div class="radiocard">
        <style>
            .video-js .vjs-tech {position: relative !important;}
        </style>
        <div>
            <video id="myVideo" class="video-js vjs-default-skin vjs-big-play-centered" controls preload="auto" data-setup='{}' style='width: 100%;height: auto'>
                <source id="source" src="http://120.46.209.170:80/hls/mystream.m3u8" type="application/x-mpegURL"></source>
            </video>
        </div>
    </div>
    </section>

    <section class="radio">
        <div class="cardtitle">
            <h2>Sign In</h2>
        </div>
        <div class="radiocard">
            <input class="nametag" type="text" id="nameInput" placeholder="Enter your name">
        </div>
    </section>

    <section class="chat-container">
            <div class="left-column">
                <div class="card left">
                    <div class="cardtitle">
                        <h2>Public Channel 0</h2>
                    </div>
                    <div class="chat-content">
                        <p><pre><div class="chat-text" id="chatchat"></div></pre></p>
                        <script>
                            let lastModifiedTime = 0;
                            setInterval(checkForUpdate, 100);

                            function checkForUpdate() {
                                fetch('./experimental/chatlog', { method: 'HEAD' })
                                    .then(response => {
                                        let currentModifiedTime = new Date(response.headers.get('last-modified')).getTime();

                                        if (currentModifiedTime !== lastModifiedTime) {
                                            lastModifiedTime = currentModifiedTime;
                                            updateAlbumName();
                                        }
                                    })
                                    .catch(error => {
                                        console.error('Error:', error);
                                    });
                            }

                            function updateAlbumName() {
                                fetch('./experimental/chatlog', { headers: { 'Content-Type': 'text/plain; charset=utf-8' } })
                                    .then(response => response.text())
                                    .then(data => {
                                        document.getElementById('chatchat').textContent = data;
                                    })
                                    .catch(error => {
                                        console.error('Error:', error);
                                    });
                            }
                        </script>
                    </div>
                </div>
            </div>
            
            <div class="right-column">
                <div class="card right">
                    <div class="cardtitle">
                        <h2>Image: Last Sent</h2>
                    </div>
                    <div class="cardimg">
                        <img id="Image1" src="" alt="Image">

                        <script>
                            function checkForUpdate() {
                                fetch('./experimental/img1', { method: 'HEAD' })
                                    .then(response => {
                                        let currentModifiedTime = new Date(response.headers.get('last-modified')).getTime();

                                        if (currentModifiedTime !== lastModifiedTime) {
                                            lastModifiedTime = currentModifiedTime;
                                            updateImageURL();
                                        }
                                    })
                                    .catch(error => {
                                        console.error('Error:', error);
                                    });
                            }

                            function updateImageURL() {
                                fetch('./experimental/img1')
                                    .then(response => response.text())
                                    .then(data => {
                                        document.getElementById('Image1').src = data;
                                    })
                                    .catch(error => {
                                        console.error('Error:', error);
                                    });
                            }

                            setInterval(updateImageURL, 100);
                        </script>
                    </div>
                </div>

                <div class="card right">
                    <div class="cardtitle">
                        <h2>Image: Second Last</h2>
                    </div>
                    <div class="cardimg">
                        <img id="Image2" src="" alt="Image">

                        <script>
                            function checkForUpdate() {
                                fetch('./experimental/img2', { method: 'HEAD' })
                                    .then(response => {
                                        let currentModifiedTime = new Date(response.headers.get('last-modified')).getTime();

                                        if (currentModifiedTime !== lastModifiedTime) {
                                            lastModifiedTime = currentModifiedTime;
                                            updateImageURL();
                                        }
                                    })
                                    .catch(error => {
                                        console.error('Error:', error);
                                    });
                            }

                            function updateImageURL() {
                                fetch('./experimental/img2')
                                    .then(response => response.text())
                                    .then(data => {
                                        document.getElementById('Image2').src = data;
                                    })
                                    .catch(error => {
                                        console.error('Error:', error);
                                    });
                            }

                            setInterval(updateImageURL, 100);
                        </script>
                    </div>
                </div>

                
            </div>
    </section>
    
    <section class="chat-container">
        <div class="left-column-2">
            <div class="card">
                <div class="cardtitle">
                    <h2>Camera: Permission Denied</h2>
                </div>
                <div class="cardimg">
                    <!-- <img id="Image" src="" alt="Image"> -->
                </div>
            </div>
        </div>

        <div class="right-column-2">
            <div class="card">
                <div class="cardtitle">
                    <h2>Image: Third Last</h2>
                </div>
                <div class="cardimg">
                    <img id="Image3" src="" alt="Image">

                    <script>
                        function checkForUpdate() {
                                fetch('./experimental/img3', { method: 'HEAD' })
                                    .then(response => {
                                        let currentModifiedTime = new Date(response.headers.get('last-modified')).getTime();

                                        if (currentModifiedTime !== lastModifiedTime) {
                                            lastModifiedTime = currentModifiedTime;
                                            updateImageURL();
                                        }
                                    })
                                    .catch(error => {
                                        console.error('Error:', error);
                                    });
                            }

                            function updateImageURL() {
                                fetch('./experimental/img3')
                                    .then(response => response.text())
                                    .then(data => {
                                        document.getElementById('Image3').src = data;
                                    })
                                    .catch(error => {
                                        console.error('Error:', error);
                                    });
                            }

                            setInterval(updateImageURL, 100);
                    </script>
                </div>
            </div>
        </div>
    </section>

    <section class="bottom-chat">
        <div class="bottom-chat-container">
            <div class="message-box">
              <textarea class="msgbox" placeholder="Type your message..."></textarea>
              <button class="send-button">Send</button>
            </div>
        </div>
        
    </section>
    
    
</body>