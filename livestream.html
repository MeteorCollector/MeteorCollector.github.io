<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <!-- <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests"> -->
    <title>iris live</title>
    <link href="https://vjs.zencdn.net/7.4.1/video-js.css" rel="stylesheet">
    <script src='https://vjs.zencdn.net/7.4.1/video.js'></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/videojs-contrib-hls/5.15.0/videojs-contrib-hls.min.js" type="text/javascript"></script>
    <link rel="stylesheet" href="livestyle.css">
</head>
<body>
    <div class="backimg"></div>
    <section class="title">
        <h1>iris terminal</h1>
    </section>
    
    <div id="container"></div>
    <script type="module">
        import * as THREE from '../build/three.module.js';
        import { OrbitControls } from './jsm/controls/OrbitControls.js';
        let renderer, camera, scene, light, controls;
        const Dom = document.querySelector( '#container' );
        const width = Dom.clientWidth, height = Dom.clientHeight;
        /**
         * @description 初始化渲染场景
         */
        function initRenderer() {
            renderer = new THREE.WebGLRenderer( { antialias: true, alpha: true } );
            renderer.setPixelRatio( window.devicePixelRatio );
            renderer.setSize( width, height );
            const containerDom = document.querySelector( '#container' );
            containerDom.appendChild( renderer.domElement );
        }
        /**
         * @description 初始化相机
         */
        function initCamera() {
            camera = new THREE.PerspectiveCamera( 45, width / height, 1, 10000 );
            camera.position.set( 5, - 20, 200 );
            camera.lookAt( 0, 3, 0 );
            window.camera = camera;
        }
        /**
         * @description 初始化场景
         */
        function initScene() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color( 0x020924 );
            scene.fog = new THREE.Fog( 0x020924, 200, 1000 );
            window.scene = scene;
        }
        /**
         * 初始化用户交互
         **/
        function initControls() {
            controls = new OrbitControls( camera, renderer.domElement );
            controls.enableDamping = true;
            controls.enableZoom = true;
            controls.autoRotate = false;
            controls.autoRotateSpeed = 2;
            controls.enablePan = true;
        }
        /**
         * @description 初始化光
         */
        function initLight() {
            const ambientLight = new THREE.AmbientLight( 0xcccccc, 1.1 );
            scene.add( ambientLight );
            var directionalLight = new THREE.DirectionalLight( 0xffffff, 0.2 );
            directionalLight.position.set( 1, 0.1, 0 ).normalize();
            var directionalLight2 = new THREE.DirectionalLight( 0xff2ffff, 0.2 );
            directionalLight2.position.set( 1, 0.1, 0.1 ).normalize();
            scene.add( directionalLight );
            scene.add( directionalLight2 );
            var hemiLight = new THREE.HemisphereLight( 0xffffff, 0x444444, 0.2 );
            hemiLight.position.set( 0, 1, 0 );
            scene.add( hemiLight );
            var directionalLight = new THREE.DirectionalLight( 0xffffff );
            directionalLight.position.set( 1, 500, - 20 );
            directionalLight.castShadow = true;
            directionalLight.shadow.camera.top = 18;
            directionalLight.shadow.camera.bottom = - 10;
            directionalLight.shadow.camera.left = - 52;
            directionalLight.shadow.camera.right = 12;
            scene.add(directionalLight);
        }
        /**
         * 窗口变动
         **/
        function onWindowResize() {
            camera.aspect = innerWidth / innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize( innerWidth, innerHeight );
            renders();
        }

        /**
         * @description 渲染
         */
        function renders() {
            renderer.clear();
            renderer.render( scene, camera );
        }

        /**
         * 更新
         **/
        function animate() {
            window.requestAnimationFrame( () => {
                if (controls) controls.update();
                renders();
                animate();
            } );
        }

        window.onload = () => {
            initRenderer();
            initCamera();
            initScene();
            initLight();
            initControls();
            animate();
            window.addEventListener('resize', onWindowResize, false);
        };

        const positions = [];
        const colors = [];
        const geometry = new THREE.BufferGeometry();
        for (var i = 0; i < 10000; i ++) {
        var vertex = new THREE.Vector3();
        vertex.x = Math.random() * 2 - 1;
        vertex.y = Math.random() * 2 - 1;
        vertex.z = Math.random() * 2 - 1;
        positions.push( vertex.x, vertex.y, vertex.z );
        var color = new THREE.Color();
        color.setHSL( Math.random() * 0.2 + 0.5, 0.55, Math.random() * 0.25 + 0.55 );
        colors.push( color.r, color.g, color.b );
        }
        geometry.setAttribute( 'position', new THREE.Float32BufferAttribute( positions, 3 ) );
        geometry.setAttribute( 'color', new THREE.Float32BufferAttribute( colors, 3 ) );
    </script>  

    <section class="radio">
    <div class="radiocard">
        <style>
            .video-js .vjs-tech {position: relative !important;}
        </style>
        <div>
            <video id="myVideo" class="video-js vjs-default-skin vjs-big-play-centered" controls preload="auto" data-setup='{}' style='width: 100%;height: auto'>
                <source id="source" src="http://120.46.209.170:80/hls/mystream.m3u8" type="application/x-mpegURL"></source>
            </video>
        </div>
    </div>
    </section>
</body>